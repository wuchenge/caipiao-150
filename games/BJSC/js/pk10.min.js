var qishu = 0, show_road = false, app = {
	timer: {},
	ym: "../../index.php",
	reset_params: function() {
		return {
			road_right: 0,
			road_start: 0,
			fj_right: 0,
			opacity: 0,
			car: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
		}
	},
	sort: function(a, r) {
		return a - r
	},
	nums_str: function(r, e) {
		var t = "";
		for (var n = 0, p = r.length; n < p; n++) t += '<span class="n' + r[n] + '" data-num="' + r[n] + '">' + r[n] + "</span>";
		return t
	},
	time: function(a) {
		var r = parseFloat(a),
			e = 0,
			t = 0,
			n = 0;
		return null != r && (r < 60 ? r = "00:" + ((n = r) > 9 ? n : "0" + n) : r >= 60 && r < 3600 ? (t = parseInt(r / 60), n = parseInt(r % 60), r = (t > 9 ? t : "0" + t) + ":" + (n > 9 ? n : "0" + n)) : r >= 3600 && (e = parseInt(r / 3600), t = parseInt(r % 3600 / 60), n = parseInt(r % 3600 % 60 % 60), r = (e > 9 ? e : "0" + e) + ":" + (t > 9 ? t : "0" + t) + ":" + (n > 9 ? n : "0" + n))), r
	},
	render_result: function(e) {
		if (app.ready(e), e.qishu) {
			var t = e.haoma.split(","),
				n = parseInt(t[0]) + parseInt(t[1]);
			$(".drawing-video .cai-num").html(app.nums_str(t))
		}
		$(".drawing-video .next span").html(e.nextqishu)
	},
	get_lottery: function(r, re) {
		var e = (new Date).getTime();
		$.ajax({
			url: app.ym + "?a=ajax_haoma&gameid=11&t=" + e + "&re=" + (re ? re : ''),//本库数据
			success: function(e) {
				var q = false;
				if (e.qishu && qishu != parseInt(e.qishu)) {
					q = true;
					qishu = parseInt(e.qishu);
				}
				r ? ((q ? app.run_result(e.haoma.split(",")) : ''), app.render_result(e)) : app.render_result(e)
			},
			error: function() {
				app.retry(false)
			}
		})
	},
	retry: function(r, e) {//重试
		var t = e && e.re ? parseInt(e.re) : 0;
		clearTimeout(app.timer.retry), app.timer.retry = setTimeout(function() {
			app.get_lottery(r, t)
		}, t)
	},
	ready: function(e) {
		var a = Math.abs(e.awartime / 1000);
		app.params = app.reset_params(), $(".ready .count").html(app.time(a)), clearInterval(app.timer.ready), app.timer.ready = setInterval(function() {
			0 === --a ? $(".light .green").show() : 1 === a ? $(".light .yellow").show() : 2 === a && ($(".light .red").show(), app.is_play("ready")), $(".ready .count").html(app.time(a))
		}, 1000), clearTimeout(app.timer.countdown), app.timer.countdown = setTimeout(function() {
			clearInterval(app.timer.ready), $(".ready,.light p").hide(), app.start(e)
		}, 1000 * a)
	},
	start: function(e) {
		app.is_play("run"), $(".wheel").show(), app.retry(true, e), clearInterval(app.timer.start), app.timer.start = setInterval(function() {
			app.params.road_right -= 10, app.params.fj_right -= .25, app.params.opacity += .1, app.params.opacity >= .8 && (app.params.opacity = 0), app.params.road_right <= -1790 && (app.params.road_right = 0), app.params.fj_right <= -1794 && (app.params.fj_right = 0), $(".road-run").css("right", app.params.road_right + "px"), $(".scenary .box").css("right", app.params.fj_right + "px"), $(".car-box .wind").css("opacity", app.params.opacity)
		}, 5);
		show_road = !show_road ? true : false;
		if (e.re == 5000) {
			if (!show_road) {
				clearInterval(app.timer.run_road), app.timer.run_road = setInterval(function() {
					app.params.road_start += 2, app.params.road_start >= 800 && (app.params.road_start = -200, clearInterval(app.timer.run_road)), $(".road-start").css("left", app.params.road_start + "px")
				}, 5);
			}
		} else {
			clearInterval(app.timer.run_road), app.timer.run_road = setInterval(function() {
				app.params.road_start -= 1, app.params.road_start < -65 && (app.params.road_start = -200, clearInterval(app.timer.run_road)), $(".road-start").css("right", app.params.road_start + "px")
			}, 15);
		}
		app.run_car(), clearInterval(app.timer.run_timer), app.timer.run_timer = setInterval(function() {
			TweenMax.killAll(), app.run_car()
		}, 3000), app.run_nums();
	},
	jiasu: function(a, r) {
		parseInt($(".car" + r).css("left")) > a ? $(".car" + r).find(".jiasu").show() : $(".car" + r).find(".jiasu").hide()
	},
	run_car: function() {
		$(".car-box").each(function(a) {
			var r = Math.floor(40 * Math.random() + 30) / 10,
				e = Math.floor(323 * Math.random()),
				t = Math.floor(10 * Math.random() + 1) / 10;
			app.jiasu(e, a + 1), TweenMax.to($(this), r, {
				right: "auto",
				left: e + "px",
				delay: t
			})
		})
	},
	run_nums: function() {
		clearInterval(app.timer.num), app.timer.num = setInterval(function() {
			var a = {
				left: [],
				arr: []
			};
			$(".car-box").each(function(r) {
				var e = parseInt($(this).css("left"));
				a.left.push(e), a[e] = r + 1
			}), a.left.sort(app.sort);
			for (var r = 0, e = a.left.length; r < e; r++) a.arr.push(a[a.left[r]]);
			app.open_nums(a.arr)
		}, 300)
	},
	run_result: function(a) {
		clearInterval(app.timer.run_timer), TweenMax.killAll();
		for (var r = 0, e = a.length; r < e; r++) {
			var t = 2 + .25 * r,
				n = Math.floor(150 + 70 * r);
			TweenMax.to(".car" + a[r], t, {
				left: n + "px",
				delay: 0
			})
		}
		TweenMax.to(".road-start", .5, {
			left: "500px",
			delay: 2
		}), clearTimeout(app.timer.show_result), app.timer.show_result = setTimeout(function() {
			clearInterval(app.timer.num), app.open_nums(a), clearInterval(app.timer.start), $(".wheel,.jiasu").hide(), app.sound.pause(), $(".shan").fadeIn(100, function() {
				$(".shan").fadeOut(500, function() {
					app.show_result(a)
				})
			})
		}, 3000)
	},
	show_result: function(a) {
		TweenMax.killAll(), clearInterval(app.timer.start), clearInterval(app.timer.run_road), clearInterval(app.timer.run_timer), clearInterval(app.timer.num), $(".runing div").attr("style", ""), app.is_play("result"), $(".result .car").each(function(r) {
			$(this).find("p img").eq(0).prop("src", "./images/winner" + a[r*2] + ".png")
			$(this).find("p img").eq(1).prop("src", "./images/winner" + a[r*2+1] + ".png")
		}), $(".result").fadeIn(150), TweenMax.to(".one", .8, {
			opacity: 1,
			right: "40%",
			top: 0,
			delay: 0
		}), TweenMax.to(".two", .8, {
			opacity: 1,
			right: "60%",
			top: 0,
			delay: .3
		}), TweenMax.to(".three", .8, {
			opacity: 1,
			right: "20%",
			top: 0,
			delay: .6
		}), TweenMax.to(".four", .8, {
			opacity: 1,
			right: "80%",
			top: 0,
			delay: .9
		}), TweenMax.to(".five", .8, {
			opacity: 1,
			right: 0,
			top: 0,
			delay: 1.2
		}), clearTimeout(app.timer.hide_result), app.timer.hide_result = setTimeout(function() {
			app.is_play("close"), app.reduction(), $(".result").fadeOut(150)
		}, 4000)
	},
	open_nums: function(a) {
		for (var r = "", e = 0, t = a.length; e < t; e++) r += '<span class="n' + a[e] + '">' + a[e] + "</span>";
		$(".cai-num").html(r)
	},
	reduction: function() {
		$(".drawing-video div").attr("style", "")
	},
	is_play: function(a) {
		"close" == a ? ($("#sound").prop("src", "").prop("loop", false), app.sound.pause()) : ("ready" == a ? $("#sound").prop("src", "./mp3/ready.mp3").prop("loop", false) : "run" == a ? $("#sound").prop("src", "./mp3/run.mp3").prop("loop", true) : "result" == a && $("#sound").prop("src", "./mp3/result.mp3").prop("loop", false), app.voice ? app.sound.play() : app.sound.pause())
	},
	voice: true,
	sound: document.getElementById("sound"),
	init: function() {
		$(".loading").remove(), app.get_lottery(false)
	}
};
app.init(), $(".voice-btn").click(function() {
	$(this).toggleClass("close"), app.voice = !$(this).hasClass("close"), $(this).hasClass("close") ? app.sound.pause() : "" != $("#sound").attr("src") && app.sound.play()
});